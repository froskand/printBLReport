Sub ButtonPrint_Click()
    Dim strPDFFileName As String
    Dim strDocID As String
    Dim strDocRev As String
    Dim strPath As String
    Dim fso As Object
    Dim wsBaseline As Worksheet
    Dim wsReview As Worksheet
    
    On Error GoTo Failure
    
    ' Get document information
    With ThisWorkbook.Worksheets("Introduction")
        strDocID = .Range("C5").Value
        strDocRev = .Range("C6").Value
    End With
    
    ' Validate that revision number exists
    If strDocRev = "" Or IsEmpty(strDocRev) Or IsNull(strDocRev) Then
        MsgBox "Error: No revision number found!" & Chr(13) & Chr(13) & _
               "Please enter a revision number in cell C6 of the Introduction sheet.", _
               vbCritical, "Missing Revision Number"
        GoTo Done
    End If
    
    ' Get the workbook path - handle SharePoint/OneDrive URLs
    strPath = Application.ActiveWorkbook.Path
    
    ' Create FileSystemObject
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    ' Check if file is on SharePoint/OneDrive (starts with http)
    If Left(strPath, 4) = "http" Then
        ' Set local path for SharePoint files
        strPath = Environ("userprofile") & "\Documents\PL3503"
        
        ' Create folder if it doesn't exist
        If Not fso.FolderExists(strPath) Then
            On Error Resume Next
            fso.CreateFolder strPath
            On Error GoTo Failure
            
            If Not fso.FolderExists(strPath) Then
                MsgBox "Error: Could not create folder!" & Chr(13) & Chr(13) & _
                       "Path: " & strPath & Chr(13) & Chr(13) & _
                       "Please create this folder manually or choose a different location.", _
                       vbCritical, "Folder Creation Failed"
                GoTo Done
            End If
        End If
        
        MsgBox "This file is stored on SharePoint/OneDrive." & Chr(13) & Chr(13) & _
               "The PDF will be saved to: " & strPath & Chr(13) & Chr(13) & _
               "For best results, sync this folder to the project SharePoint.", _
               vbInformation, "SharePoint File Detected"
    End If
    
    ' Build PDF filename
    strPDFFileName = strPath & "\PL3503 " & strDocID & " rev " & strDocRev & " BaselineReport.pdf"
    
    ' Check if file already exists
    If fso.FileExists(strPDFFileName) Then
        MsgBox "A file with this name already exists:" & Chr(13) & Chr(13) & _
               strPDFFileName & Chr(13) & Chr(13) & _
               "Please update the revision number in cell C6 of the Introduction sheet.", _
               vbExclamation, "File Already Exists"
        GoTo Done
    End If
    
    ' Confirm save
    If MsgBox("Do you want to save the baseline document as a PDF?" & Chr(13) & Chr(13) & _
              "Saving as: " & strPDFFileName & Chr(13) & _
              "Path length: " & Len(strPDFFileName) & " characters", vbOKCancel + vbQuestion, "Save PDF") = vbCancel Then
        GoTo Done
    End If
    
    ' Set up repeating rows for Baseline content sheet
    Set wsBaseline = ThisWorkbook.Worksheets("Baseline content")
    With wsBaseline.PageSetup
        .PrintTitleRows = "$2:$4"  ' Repeat rows 2-4 as headers
    End With
    
    ' Set up repeating rows for Review sheet
    Set wsReview = ThisWorkbook.Worksheets("Review")
    With wsReview.PageSetup
        .PrintTitleRows = "$24:$25"  ' Repeat rows 24-25 as headers
    End With
    
    ' Export selected sheets to PDF
    ThisWorkbook.Sheets(Array("Introduction", "Review", "Baseline content", "Change tracking")).Select
    ActiveSheet.ExportAsFixedFormat Type:=xlTypePDF, Filename:=strPDFFileName
    
    ' Verify file was created
    If Not fso.FileExists(strPDFFileName) Then
        MsgBox "Error: PDF file was not saved successfully!" & Chr(13) & Chr(13) & _
               "Expected location: " & strPDFFileName, vbCritical, "Save Failed"
    Else
        MsgBox "PDF saved successfully!" & Chr(13) & Chr(13) & strPDFFileName, vbInformation, "Success"
    End If
    
Done:
    ThisWorkbook.Sheets("Introduction").Select
    Exit Sub
    
Failure:
    MsgBox "Failed to save PDF: " & Err.Description, vbCritical, "Error"
    ThisWorkbook.Sheets("Introduction").Select
End Sub